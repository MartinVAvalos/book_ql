import{Client as e,createRequest as u}from"@urql/core";export*from"@urql/core";import{isRef as a,ref as r,getCurrentInstance as t,provide as l,inject as v,reactive as n,shallowRef as s,watchEffect as i,onBeforeUnmount as o,onMounted as c}from"vue";import{subscribe as f,onEnd as p,toPromise as q,take as x,filter as b,onPush as d}from"wonka";var h=new WeakMap;function y(u){var v;v=a(u)?u:r(u instanceof e?u:new e(u));var n=t();return n&&h.set(n,v),l("$urql",v),v.value}function P(u,t){var l;l=a(t)?t:r(t instanceof e?t:new e(t)),u.provide("$urql",l)}function m(){var e=t(),u=v("$urql");return!u&&e&&(u=h.get(e)),u}var g=e=>"function"==typeof e?e():null!=e&&a(e)?e.value:e,w=(e,u)=>{for(var a in u)if(e.value[a]!==u[a])return void(e.value=u)},M={flush:"pre"};function Q(e){return S(e)}function S(e,a=m(),t=[]){var l=n(e),v=r(),o=r(!1),c=r(!1),q=r(),x=r(),b=r(),d=r(!!g(l.pause)),h=s({request:u(g(l.query),g(l.variables)),requestPolicy:g(l.requestPolicy),isPaused:d.value}),y=r();t.push(i((()=>{w(h,{request:u(g(l.query),g(l.variables)),requestPolicy:g(l.requestPolicy),isPaused:d.value})}),M)),t.push(i((()=>{y.value=h.value.isPaused?void 0:a.value.executeQuery(h.value.request,{requestPolicy:g(l.requestPolicy),...g(l.context)})}),M));var P={data:v,stale:o,error:q,operation:x,extensions:b,fetching:c,isPaused:d,executeQuery(e){var u=y.value=a.value.executeQuery(h.value.request,{requestPolicy:g(l.requestPolicy),...g(l.context),...e});return{...Q,then(e,a){var r;return new Promise((e=>{var a=!1;r=f((()=>{P.fetching.value||P.stale.value||(r&&r.unsubscribe(),a=!0,e(P))}))(u),a&&r.unsubscribe()})).then(e,a)}}},pause(){d.value=!0},resume(){d.value=!1}};t.push(i((e=>{y.value?(c.value=!0,o.value=!1,e(f((e=>{v.value=e.data,o.value=!!e.stale,c.value=!1,q.value=e.error,x.value=e.operation,b.value=e.extensions}))(p((()=>{c.value=!1,o.value=!1}))(y.value)).unsubscribe)):(c.value=!1,o.value=!1)}),{flush:"sync"}));var Q={...P,then(e,u){var a;return new Promise((e=>{if(!y.value)return e(P);var u=!1;a=f((()=>{P.fetching.value||P.stale.value||(a&&a.unsubscribe(),u=!0,e(P))}))(y.value),u&&a.unsubscribe()})).then(e,u)}};return Q}function $(e){return k(e)}function k(e,a=m()){var t=r(),l=r(!1),v=r(!1),n=r(),s=r(),i=r();return{data:t,stale:l,fetching:v,error:n,operation:s,extensions:i,executeMutation:(r,o)=>(v.value=!0,q(x(1)(b((e=>!e.hasNext))(d((e=>{t.value=e.data,l.value=e.stale,v.value=!1,n.value=e.error,s.value=e.operation,i.value=e.extensions}))(a.value.executeMutation(u(g(e),g(r)),o||{}))))))}}var N={flush:"pre"};function W(e,u){return j(e,u)}function j(e,a,t=m(),l=[]){var v=n(e),o=r(),c=r(!1),q=r(!1),x=r(),b=r(),d=r(),h=r(a),y=r(!!g(v.pause)),P=s({request:u(g(v.query),g(v.variables)),isPaused:y.value}),M=r();l.push(i((()=>{w(P,{request:u(g(v.query),g(v.variables)),isPaused:y.value})}),N)),l.push(i((()=>{M.value=y.value?void 0:t.value.executeSubscription(P.value.request,{...g(v.context)})}),N)),l.push(i((e=>{M.value?(q.value=!0,e(f((e=>{q.value=!0,o.value=null!=e.data&&"function"==typeof h.value?h.value(o.value,e.data):e.data,x.value=e.error,d.value=e.extensions,c.value=!!e.stale,b.value=e.operation}))(p((()=>{q.value=!1}))(M.value)).unsubscribe)):q.value=!1}),N));var Q={data:o,stale:c,error:x,operation:b,extensions:d,fetching:q,isPaused:y,executeSubscription:e=>(M.value=t.value.executeSubscription(P.value.request,{...g(v.context),...e}),Q),pause(){y.value=!0},resume(){y.value=!1}};return Q}function z(){var e=m(),u=[];return o((()=>{for(var e;e=u.shift();)e()})),{client:e.value,useQuery:a=>S(a,e,u),useSubscription:(a,r)=>j(a,r,e,u),useMutation:u=>k(u,e)}}export{P as default,P as install,y as provideClient,z as useClientHandle,$ as useMutation,Q as useQuery,W as useSubscription};
//# sourceMappingURL=urql-vue.min.mjs.map
